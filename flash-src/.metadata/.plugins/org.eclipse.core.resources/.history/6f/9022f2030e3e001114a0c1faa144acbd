package com.dozeo.pusheras
{
	import com.dozeo.pusheras.vo.PusherOptionsVO;
	import com.dozeo.pusheras.vo.WebsocketStatusVO;
	
	import net.gimite.websocket.WebSocket;
	import net.gimite.websocket.WebSocketEvent;
	import net.gimite.websocket.WebSocketFrame;
	
	public class Pusher
	{
		// PusherAS vars
		private var _options:PusherOptionsVO = null;
		
		// websocket vars
		private var _websocket:WebSocket = null;
		private var _websocketStatus:WebsocketStatusVO;

		/**
		 * @param options all required options for the pusher connection
		 * */
		public function Pusher(options:PusherOptionsVO)
		{
			// parameter check
			if(options == null)
				throw new Error('options cannot be null');
			
			// store options
			_options = options;
			
			// create small storage object for the websocket status
			_websocketStatus = new WebsocketStatusVO();
			
			// connect to websocket server
			connect();
		}
		
		/**
		 * inital socket connection
		 * */
		private function connect():void
		{
			// check for websocket status storage object
			if(_websocketStatus == null)
				throw new Error('websocket status cannot be null');
			
			// check if connection attempt is already in progress
			if(_websocketStatus.connecting)
			{
				log('Already attempting connection. Aborting...');
				return;
			}
			
			// check if websocket is already connected
			if(_websocketStatus.connected)
			{
				log('Connection is already established. Aborting connection attempt...');
				return;
			}
			
			// 
			var url:String;
			
			if(_options.encrypted || _options.secure)
			{
				url = "wss://" + HOST + ":" + SECURE_PORT + connectionPath;
			}
			else
			{
				url = "ws://" + HOST + ":" + STANDARD_PORT + connectionPath;
			}
			
			
			
		}
		
		private function log(msg:String):void
		{
			trace('LOG: ' + msg);
		}
		
	}
}